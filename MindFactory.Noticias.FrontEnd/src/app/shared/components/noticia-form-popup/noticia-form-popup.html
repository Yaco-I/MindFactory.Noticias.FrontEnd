<div class="popup-overlay" (click)="cerrar()">
  <div class="popup-content" (click)="$event.stopPropagation()">
    <button class="close-button" (click)="cerrar()">×</button>
    <h2>{{ noticia?.id ? 'Editar Noticia' : 'Nueva Noticia' }}</h2>

    <form [formGroup]="noticiaForm" (ngSubmit)="guardar()">
      <div class="form-group">
        <label for="titulo">Título</label>
        <input id="titulo" formControlName="titulo" type="text" placeholder="Título de la noticia">
        <div *ngIf="noticiaForm.get('titulo')?.touched && noticiaForm.get('titulo')?.errors?.['required']"
          class="error-message">
          El título es requerido.
        </div>
      </div>

      <div class="form-group">
        <label for="url">URL</label>
        <input id="url" formControlName="url" type="text" placeholder="URL amigable">
        <div *ngIf="noticiaForm.get('url')?.touched && noticiaForm.get('url')?.errors?.['required']"
          class="error-message">
          La URL es requerida.
        </div>
      </div>

      <div class="form-group">
        <label for="contenido">Contenido</label>
        <textarea id="contenido" formControlName="contenido" rows="5"
          placeholder="Contenido completo de la noticia"></textarea>
        <div *ngIf="noticiaForm.get('contenido')?.touched && noticiaForm.get('contenido')?.errors?.['required']"
          class="error-message">
          El contenido es requerido.
        </div>
      </div>

      <div class="form-group">
        <label for="resumen">Resumen</label>
        <textarea id="resumen" formControlName="resumen" rows="3" placeholder="Resumen opcional"></textarea>
      </div>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Categoría</mat-label>
        <mat-select formControlName="categoriaId" placeholder="Seleccione una categoría">
          <mat-option [value]="null" disabled>Seleccione una categoría</mat-option>
          <mat-option *ngFor="let categoria of categorias" [value]="categoria.id">
            {{ categoria.nombre }}
          </mat-option>
        </mat-select>
        <mat-error
          *ngIf="noticiaForm.get('categoriaId')?.touched && noticiaForm.get('categoriaId')?.hasError('required')">
          La categoría es requerida.
        </mat-error>
      </mat-form-field>


      <div class="form-group checkbox-group">
        <input id="publicada" formControlName="publicada" type="checkbox">
        <label for="publicada">Publicada</label>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-secondary" (click)="cerrar()">Cancelar</button>
        <button type="submit" class="btn-primary" [disabled]="isLoading">
          <span *ngIf="!isLoading">Guardar</span>
          <div *ngIf="isLoading" class="spinner"></div>
        </button>
      </div>

      <div *ngIf="errorMessage" class="error-message server-error">
        {{ errorMessage }}
      </div>
    </form>
  </div>
</div>